<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>موقع التحكم - الريس</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: Arial, sans-serif; background: #f0f2f5; margin:0; padding:0; }
        .container { max-width: 800px; margin: 40px auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 5px 20px rgba(0,0,0,0.1);}
        h1, h2 { text-align: center; color: #333; }
        .code-box { background: #eee; padding: 15px; margin: 20px 0; text-align: center; font-size: 1.5rem; font-weight: bold; border-radius: 8px; }
        .btn { padding: 10px 20px; margin: 5px; border:none; border-radius: 5px; cursor:pointer; font-weight:bold; }
        .btn-primary { background: #4361ee; color: white; }
        .btn-success { background: #4cc9f0; color: white; }
        .btn-danger { background: #f72585; color: white; }
        .status { text-align:center; margin:20px 0; padding:10px; border-radius:5px; font-weight:bold; }
        .active { background: #d0f0fd; color: #0a96c7; }
        .inactive { background: #fde0e6; color: #c51162; }
        .offline { background: #f5f5f5; color: #999; }
    </style>
</head>
<body>
    <div class="container">
        <h1>موقع التحكم بالاداة</h1>
        <h2>توليد كود التحكم</h2>

        <div class="code-box" id="generatedCode">---</div>
        <div style="text-align:center;">
            <button class="btn btn-primary" id="generateBtn"><i class="fas fa-redo"></i> توليد كود جديد</button>
            <button class="btn btn-success" id="activateBtn"><i class="fas fa-play"></i> تفعيل الكود</button>
            <button class="btn btn-danger" id="deactivateBtn"><i class="fas fa-stop"></i> إيقاف الكود</button>
        </div>

        <div class="status offline" id="statusBox">الحالة: غير متصل</div>
    </div>

    <script>
        let deviceCode = "";
        const codeBox = document.getElementById('generatedCode');
        const statusBox = document.getElementById('statusBox');

        async function fetchCode(action){
            try {
                const res = await fetch(`/api/${action}`, { method: 'POST' });
                const data = await res.json();

                if(data.code) deviceCode = data.code;
                if(data.status) updateStatus(data.status);
                if(action === 'generate') codeBox.textContent = deviceCode;
            } catch(err){
                console.error(err);
            }
        }

        function updateStatus(status){
            statusBox.textContent = "الحالة: " + status.toUpperCase();
            statusBox.className = "status " + (status === "active" ? "active" : status === "inactive" ? "inactive" : "offline");
        }

        document.getElementById('generateBtn').addEventListener('click', () => fetchCode('generate'));
        document.getElementById('activateBtn').addEventListener('click', () => fetchCode('activate'));
        document.getElementById('deactivateBtn').addEventListener('click', () => fetchCode('deactivate'));

        // توليد كود تلقائي عند فتح الصفحة
        fetchCode('generate');
    </script>
</body>
</html>
